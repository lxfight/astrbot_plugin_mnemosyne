# FAISS é…ç½®ç»“æ„æ›´æ–°æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†æ›´å¥½åœ°ç»„ç»‡é…ç½®ç»“æ„ï¼ŒFAISS ç›¸å…³é…ç½®é¡¹å·²è¢«å½’ç±»åˆ° `faiss_config` å¯¹è±¡ä¸‹ã€‚è¿™æ ·å¯ä»¥ï¼š

- ğŸ—‚ï¸ **æ›´æ¸…æ™°çš„é…ç½®ç»“æ„**: ç›¸å…³é…ç½®é¡¹é›†ä¸­ç®¡ç†
- ğŸ”§ **æ›´å¥½çš„æ‰©å±•æ€§**: ä¾¿äºæ·»åŠ æ–°çš„ FAISS é…ç½®é€‰é¡¹
- ğŸ“ **æ›´æ˜“ç»´æŠ¤**: é…ç½®é€»è¾‘æ›´åŠ æ¸…æ™°

## ğŸ”„ é…ç½®å˜æ›´å¯¹æ¯”

### æ—§é…ç½®ç»“æ„ (v0.6.0 ä¹‹å‰)
```json
{
  "vector_database_type": "faiss",
  "faiss_data_path": "faiss_data",
  "faiss_index_type": "IndexFlatL2",
  "faiss_nlist": 100,
  "embedding_provider_id": "your_provider_id",
  "LLM_providers": "your_llm_provider"
}
```

### æ–°é…ç½®ç»“æ„ (v0.6.0+)
```json
{
  "vector_database_type": "faiss",
  "faiss_config": {
    "faiss_data_path": "faiss_data",
    "faiss_index_type": "IndexFlatL2",
    "faiss_nlist": 100
  },
  "embedding_provider_id": "your_provider_id",
  "LLM_providers": "your_llm_provider"
}
```

## ğŸ› ï¸ è‡ªåŠ¨è¿ç§»

æ’ä»¶æä¾›äº†è‡ªåŠ¨è¿ç§»åŠŸèƒ½ï¼Œæ— éœ€æ‰‹åŠ¨ä¿®æ”¹é…ç½®ï¼š

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨è¿ç§»å‘½ä»¤ï¼ˆæ¨èï¼‰
```bash
# æŸ¥çœ‹å½“å‰é…ç½®çŠ¶æ€
/memory status

# è‡ªåŠ¨è¿ç§»é…ç½®ç»“æ„
/memory migrate_config

# éªŒè¯è¿ç§»ç»“æœ
/memory validate_config
```

### æ–¹æ³•äºŒï¼šä½¿ç”¨è¿ç§»è„šæœ¬
```bash
python docs/development/migration_tool.py --config your_config.json
```

## ğŸ“Š é…ç½®é¡¹è¯¦è§£

### `faiss_config` å¯¹è±¡åŒ…å«çš„é…ç½®é¡¹

| é…ç½®é¡¹ | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|--------|------|
| `faiss_data_path` | string | `"faiss_data"` | FAISS æ•°æ®å­˜å‚¨è·¯å¾„ï¼ˆç›¸å¯¹äºæ’ä»¶æ•°æ®ç›®å½•ï¼‰ |
| `faiss_index_type` | string | `"IndexFlatL2"` | FAISS ç´¢å¼•ç±»å‹ |
| `faiss_nlist` | integer | `100` | IVF ç´¢å¼•çš„èšç±»ä¸­å¿ƒæ•°é‡ |

### ç´¢å¼•ç±»å‹é€‰æ‹©

| ç´¢å¼•ç±»å‹ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|----------|------|----------|
| `IndexFlatL2` | ç²¾ç¡®æœç´¢ï¼Œé€Ÿåº¦è¾ƒæ…¢ | å°æ•°æ®é›†ï¼Œè¦æ±‚é«˜ç²¾åº¦ |
| `IndexFlatIP` | å†…ç§¯ç›¸ä¼¼åº¦ï¼Œç²¾ç¡®æœç´¢ | å½’ä¸€åŒ–å‘é‡ï¼Œå†…ç§¯è®¡ç®— |
| `IndexIVFFlat` | å¿«é€Ÿæœç´¢ï¼Œç•¥æœ‰ç²¾åº¦æŸå¤± | å¤§æ•°æ®é›†ï¼Œå¹³è¡¡é€Ÿåº¦å’Œç²¾åº¦ |
| `IndexHNSWFlat` | é«˜æ€§èƒ½è¿‘ä¼¼æœç´¢ | å¤§æ•°æ®é›†ï¼Œè¦æ±‚é«˜é€Ÿåº¦ |

## ğŸ” éªŒè¯é…ç½®

### æ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®
```bash
# éªŒè¯é…ç½®ç»“æ„å’Œå‚æ•°
/memory validate_config

# æŸ¥çœ‹è¯¦ç»†çŠ¶æ€ä¿¡æ¯
/memory status
```

### é…ç½®éªŒè¯è¦ç‚¹
- âœ… `faiss_config` å¯¹è±¡å­˜åœ¨
- âœ… `faiss_data_path` ä¸ºæœ‰æ•ˆè·¯å¾„
- âœ… `faiss_index_type` ä¸ºæ”¯æŒçš„ç±»å‹
- âœ… `faiss_nlist` ä¸ºæ­£æ•´æ•°ï¼ˆä»… IVF ç´¢å¼•éœ€è¦ï¼‰

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: æ—§é…ç½®è¿˜èƒ½ä½¿ç”¨å—ï¼Ÿ
**A**: å¯ä»¥ï¼Œä½†å»ºè®®è¿ç§»åˆ°æ–°ç»“æ„ã€‚æ’ä»¶ä¼šè‡ªåŠ¨å¤„ç†æ—§é…ç½®ï¼Œä½†æ–°åŠŸèƒ½å¯èƒ½éœ€è¦æ–°ç»“æ„ã€‚

### Q2: è¿ç§»ä¼šä¸¢å¤±æ•°æ®å—ï¼Ÿ
**A**: ä¸ä¼šã€‚é…ç½®è¿ç§»åªæ˜¯é‡æ–°ç»„ç»‡é…ç½®ç»“æ„ï¼Œä¸ä¼šå½±å“å·²å­˜å‚¨çš„å‘é‡æ•°æ®ã€‚

### Q3: å¦‚ä½•å›æ»šåˆ°æ—§é…ç½®ï¼Ÿ
**A**: æ‰‹åŠ¨ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼Œå°† `faiss_config` ä¸‹çš„é…ç½®é¡¹ç§»åˆ°æ ¹çº§åˆ«ï¼Œä½†ä¸æ¨èè¿™æ ·åšã€‚

### Q4: æ–°é…ç½®æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ
**A**: 
- æ›´æ¸…æ™°çš„é…ç½®ç»„ç»‡
- æ›´å¥½çš„ç±»å‹æ£€æŸ¥å’ŒéªŒè¯
- ä¾¿äºæ·»åŠ æ–°çš„ FAISS åŠŸèƒ½
- ä¸å…¶ä»–æ•°æ®åº“é…ç½®ä¿æŒä¸€è‡´

## ğŸ“ æ‰‹åŠ¨è¿ç§»æ­¥éª¤

å¦‚æœéœ€è¦æ‰‹åŠ¨è¿ç§»é…ç½®ï¼š

### æ­¥éª¤ 1: å¤‡ä»½åŸé…ç½®
```bash
cp your_config.json your_config.json.backup
```

### æ­¥éª¤ 2: ä¿®æ”¹é…ç½®ç»“æ„
å°†ä»¥ä¸‹é…ç½®é¡¹ï¼š
```json
{
  "faiss_data_path": "faiss_data",
  "faiss_index_type": "IndexFlatL2", 
  "faiss_nlist": 100
}
```

æ”¹ä¸ºï¼š
```json
{
  "faiss_config": {
    "faiss_data_path": "faiss_data",
    "faiss_index_type": "IndexFlatL2",
    "faiss_nlist": 100
  }
}
```

### æ­¥éª¤ 3: éªŒè¯é…ç½®
```bash
/memory validate_config
```

## ğŸ¯ æœ€ä½³å®è·µ

### 1. ä½¿ç”¨ç›¸å¯¹è·¯å¾„
```json
{
  "faiss_config": {
    "faiss_data_path": "faiss_data"  // æ¨èï¼šç›¸å¯¹è·¯å¾„
  }
}
```

### 2. æ ¹æ®æ•°æ®é‡é€‰æ‹©ç´¢å¼•
- **å°æ•°æ®é›† (<10K)**: `IndexFlatL2`
- **ä¸­ç­‰æ•°æ®é›† (10K-100K)**: `IndexIVFFlat`
- **å¤§æ•°æ®é›† (>100K)**: `IndexHNSWFlat`

### 3. è°ƒæ•´ nlist å‚æ•°
```json
{
  "faiss_config": {
    "faiss_index_type": "IndexIVFFlat",
    "faiss_nlist": 100  // æ•°æ®é‡å¤§æ—¶å¯å¢åŠ åˆ° 1000+
  }
}
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é‡æ„æŒ‡å—](REFACTOR_GUIDE.md) - å®Œæ•´çš„ v0.6.0 é‡æ„è¯´æ˜
- [è¿ç§»ç¤ºä¾‹](MIGRATION_EXAMPLES.md) - è¯¦ç»†çš„è¿ç§»ä½¿ç”¨ç¤ºä¾‹
- [æ’ä»¶æ•°æ®ç›®å½•](../guides/PLUGIN_DATA_DIRECTORY.md) - æ•°æ®ç›®å½•ç®¡ç†è¯´æ˜

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœåœ¨é…ç½®è¿ç§»è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. ä½¿ç”¨ `/memory status` æ£€æŸ¥å½“å‰çŠ¶æ€
2. ä½¿ç”¨ `/memory validate_config` éªŒè¯é…ç½®
3. æŸ¥çœ‹ AstrBot æ—¥å¿—è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. åœ¨ [GitHub Issues](https://github.com/lxfight/astrbot_plugin_mnemosyne/issues) å¯»æ±‚å¸®åŠ©

---

*æœ€åæ›´æ–°: 2024-06-23*  
*é€‚ç”¨ç‰ˆæœ¬: v0.6.0+*
